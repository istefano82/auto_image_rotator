{% extends "layout.html" %}

{% block head %}
    {{ super() }}
{% endblock %}

{% block content %}

<center><h2><font color='white'>Upload your image below</font></h2></center>

<!--  <form class="ui form" action = {{ url_for('upload_file') }} method = "POST"-->
<!--         enctype = "multipart/form-data">-->
<!--         <input type = "file" name = "file" />-->
<!--         <input type = "submit"/>-->
<!--      </form>-->
<!--TODO Enable user registration and authentication for batch upload-->
{# {% if current_user.is_authenticated %} #}
    <hr>
  <form class="ui form" id="imageUploadForm" action = {{ url_for('upload_files') }}
method = "POST"
         enctype = "multipart/form-data">
      <input type="file" multiple="" (change)="fileEvent($event)"
         class="inputfile" id="embedpollfileinput" name="file[]"/>
      <label for="embedpollfileinput"
             class="ui huge teal center floated button">
          <i class="ui upload icon"></i>
        Upload images
      </label>
      <input type="submit" class="inputfile" id="submitfiles"
             name="submitfiles"/>
      <label for="submitfiles" class="ui huge blue center floated button">
        Submit
      </label>
  </form>
  <div class="ui disabled active dimmer" id="activeDimmer" >
    <div class="ui disabled large indeterminate text loader" id="loader"
    >Flipping your images</div>
  <p></p>
</div>
  <div class="ui tiny images" id="selectedFiles"></div>
{# {% endif %} #}

<script>
	var selDiv = "";
	var storedFiles = [];

	document.addEventListener("DOMContentLoaded", init, false);

	function init() {
		document.querySelector('#embedpollfileinput').addEventListener('change', handleFileSelect, false);
		selDiv = document.querySelector("#selectedFiles");
		dim = document.querySelector("#activeDimmer");
		loader = document.querySelector("#loader");
		document.querySelector('#imageUploadForm').addEventListener('submit', handleForm, false);
	}

	function handleFileSelect(e) {
        var html = "<hr>";
        selDiv.innerHTML += html;
		var files = e.target.files;
		var filesArr = Array.prototype.slice.call(files);
		filesArr.forEach(function(f) {

			if(!f.type.match("image.*")) {
				return;
			}
			storedFiles.push(f);

			var reader = new FileReader();
			reader.onload = function (e) {
				html = "<img  src=\"" + e.target.result + "\">";
				selDiv.innerHTML += html;

			}
			reader.readAsDataURL(f);
		});
	}

	function handleForm(e) {
	    dim.className = "ui active dimmer"
	    loader.className = "ui large indeterminate text loader"
		console.log(loader.class);
    }
</script>


<style>

	#selectedFiles img {
	    width: 80px;
	    height: 80px;
		float: left;
		margin-bottom:10px;
	}

.grid.container {
  margin-top: 5em;
}
.inputfile {
	width: 0.1px;
	height: 0.1px;
	opacity: 0;
	overflow: hidden;
	position: absolute;
	z-index: -1;
	span: 3;
}
</style>
{% endblock %}

